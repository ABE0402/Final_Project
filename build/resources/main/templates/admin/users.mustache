<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"><title>유저 관리 - 관리자</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-body-tertiary">
{{> layout/header}}

<main class="container py-5" style="max-width:1200px;">
    <h3 class="fw-bold mb-4">유저 관리</h3>

    {{#msg}}<div class="alert alert-success">{{.}}</div>{{/msg}}
    {{#err}}<div class="alert alert-danger">{{.}}</div>{{/err}}

    <form class="row g-2 mb-3" method="get" action="/admin/users">
        <div class="col-md-5">
            <input type="text" class="form-control" name="q" {{#q}}value="{{.}}"{{/q}} placeholder="이메일/이름/닉네임/전화">
        </div>
        <div class="col-md-3">
            <select class="form-select" name="status">
                <option value="">상태: 전체</option>
                <option value="ACTIVE" {{#equalsActive}}selected{{/equalsActive}}>활성</option>
                <option value="SUSPENDED" {{#equalsSuspended}}selected{{/equalsSuspended}}>정지</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select" name="role">
                <option value="">역할: 전체</option>
                <option value="USER" {{#equalsUser}}selected{{/equalsUser}}>일반</option>
                <option value="OWNER" {{#equalsOwner}}selected{{/equalsOwner}}>점주</option>
            </select>
        </div>
        <div class="col-md-1 d-grid">
            <button class="btn btn-primary" type="submit">검색</button>
        </div>
    </form>

    <div class="table-responsive bg-white shadow-sm rounded">
        <table class="table align-middle mb-0">
            <thead class="table-light">
            <tr>
                <th>ID</th><th>이메일</th><th>닉네임</th><th>이름</th><th>역할</th><th>상태</th><th>가입일</th><th style="width:260px;"></th>
            </tr>
            </thead>
            <tbody>
            {{#users}}
                <tr>
                    <td>{{id}}</td>
                    <td>{{#email}}{{.}}{{/email}}{{^email}}-{{/email}}</td>
                    <td>{{#nickname}}{{.}}{{/nickname}}{{^nickname}}-{{/nickname}}</td>
                    <td>{{#name}}{{.}}{{/name}}{{^name}}-{{/name}}</td>
                    <td><span class="badge bg-secondary">{{role}}</span></td>
                    <td>
                        {{#isActive}}<span class="badge bg-success">ACTIVE</span>{{/isActive}}
                        {{#isSuspended}}<span class="badge bg-danger">SUSPENDED</span>{{/isSuspended}}
                        {{^isActive}}{{^isSuspended}}<span class="badge bg-secondary">{{accountStatusText}}</span>{{/isSuspended}}{{/isActive}}
                    </td>
                    <td>{{#createdAt}}{{.}}{{/createdAt}}{{^createdAt}}-{{/createdAt}}</td>
                    <td>
                        <div class="d-flex gap-2">
                            {{#canSuspend}}
                                <form method="post" action="/admin/users/{{id}}/suspend" onsubmit="return confirm('정지하시겠습니까?');">
                                    {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                    <button class="btn btn-sm btn-outline-danger" type="submit">정지</button>
                                </form>
                            {{/canSuspend}}

                            {{#canResume}}
                                <form method="post" action="/admin/users/{{id}}/resume" onsubmit="return confirm('복구하시겠습니까?');">
                                    {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                    <button class="btn btn-sm btn-outline-success" type="submit">복구</button>
                                </form>
                            {{/canResume}}
                        </div>
                    </td>
                </tr>
            {{/users}}
            {{^users}}
                <tr><td colspan="8" class="text-center text-muted">검색 결과가 없습니다.</td></tr>
            {{/users}}
            </tbody>
        </table>
    </div>
</main>

{{> layout/footer}}
</body>
</html>
