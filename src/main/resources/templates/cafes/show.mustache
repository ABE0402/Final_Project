<!-- templates/cafes/show.mustache -->
<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>{{#cafe}}{{name}}{{/cafe}} - Hong Around</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/app.css" rel="stylesheet" />
    <style>
        :root{
          --olive:#5b7c38; --olive-50:#eef3e7;
        }
        .hero{
          position:relative; border-radius:1rem; overflow:hidden; min-height:260px;
          background:#f2f2f2 center/cover no-repeat;
        }
        .hero-overlay{
          position:absolute; inset:0; background:linear-gradient(180deg,rgba(0,0,0,.0),rgba(0,0,0,.55));
        }
        .hero-meta{
          position:absolute; left:1rem; right:1rem; bottom:1rem; color:#fff;
        }
        .chip{display:inline-block; padding:.25rem .6rem; border-radius:999px; background:rgba(255,255,255,.9); color:#2f2f2f; font-size:.8rem; margin:.15rem .25rem .15rem 0}
        .chip-olive{background:var(--olive); color:#fff}
        .line-2{
          display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
        }
        .thumb-rail img{object-fit:cover;width:100%;height:120px;border-radius:.5rem}
        .map-box{height:280px;background:#eef1e6;border:1px solid #dbe3c0;border-radius:.5rem}
        .ratio-16x9{background:#f7f7f7 center/cover no-repeat}

        .owner-reply{background:var(--olive-50); border-left:4px solid var(--olive); border-radius:.5rem; padding:.75rem}
        .owner-reply .meta{font-size:.8rem; color:#6c757d}
    </style>
</head>
<body class="bg-body-tertiary">
{{> layout/header}}

<main class="container py-4">

    <!-- íˆì–´ë¡œ(ëŒ€í‘œì‚¬ì§„ + ê¸°ë³¸ì •ë³´) -->
    <section class="hero shadow-sm mb-4"
             style="background-image:url('{{#cafe}}{{#heroImageUrl}}{{.}}{{/heroImageUrl}}{{^heroImageUrl}}/images/placeholder_shop.jpg{{/heroImageUrl}}{{/cafe}}')">
        <div class="hero-overlay"></div>
        <div class="hero-meta">
            <div class="d-flex flex-wrap align-items-center gap-2">
                <h3 class="mb-0">{{#cafe}}{{name}}{{/cafe}}</h3>
                <span class="badge bg-light text-dark">â­ {{avg}}</span>
                <span class="badge bg-light text-dark">ë¦¬ë·° {{#cafe}}{{reviewCount}}{{/cafe}}</span>
            </div>
            <div class="mt-1 small">{{#cafe}}{{addressRoad}}{{/cafe}}</div>

            {{#hashtags}}
                <div class="mt-1 small text-white-50">{{.}}</div>
            {{/hashtags}}
            <!-- íƒœê·¸ ì¹© (ìˆì„ ë•Œë§Œ) -->
            <div class="mt-2">
                {{#tagsAll}}
                    <span class="chip">{{.}}</span>
                {{/tagsAll}}
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="mt-3 d-flex gap-2 flex-wrap">
                <a class="btn btn-sm btn-light" href="/cafes/{{cafe.id}}/reviews/new">ë¦¬ë·° ì‘ì„±</a>
                <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#favConfirmModal">
                    {{#isFav}}ì¦ê²¨ì°¾ê¸° í•´ì œ{{/isFav}}{{^isFav}}ì¦ê²¨ì°¾ê¸° ì¶”ê°€{{/isFav}}
                </button>
                <button class="action-btn primary"
                        onclick="location.href='/reserve?type=CAFE&id={{cafe.id}}'">
                ì˜ˆì•½í•˜ê¸°
                </button>
            </div>
        </div>
    </section>

    <!-- ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ -->
    <div class="modal fade" id="favConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title">ì¦ê²¨ì°¾ê¸°</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
            </div>
            <div class="modal-body">
                {{#isFav}}ì¦ê²¨ì°¾ê¸°ë¥¼ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?{{/isFav}}
                {{^isFav}}ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?{{/isFav}}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ì•„ë‹ˆìš”</button>
                <form method="post" action="/cafes/{{cafe.id}}/favorite" class="m-0">
                    {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                    <button type="submit" class="btn btn-olive">ë„¤</button>
                </form>
            </div>
        </div></div>
    </div>

    <!-- ìƒë‹¨ ì„œë¸Œ ì´ë¯¸ì§€ ë ˆì¼ (ìˆì„ ë•Œë§Œ) -->
    {{#images}}
        <div class="row g-2 mb-3 thumb-rail">
            {{#.}}
                <div class="col-4"><img src="{{.}}" alt=""></div>
            {{/.}}
        </div>
    {{/images}}

    <div class="row g-3">
        <!-- ì¢Œì¸¡ ë©”ì¸ ì •ë³´ -->
        <div class="col-12 col-lg-8">
            <div class="row g-3">
                <!-- ë§¤ì¥ ì •ë³´ -->
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-body">
                            <h6 class="mb-3">ë§¤ì¥ ì •ë³´</h6>
                            <ul class="list-unstyled small mb-0">
                                <li>ğŸ“ {{#cafe}}{{addressRoad}}{{/cafe}}</li>
                                <li>ğŸ“ {{#cafe}}{{#phone}}{{.}}{{/phone}}{{^phone}}-{{/phone}}{{/cafe}}</li>
                                <li class="mt-2">
                                    <div class="text-muted mb-1">ì˜ì—…ì‹œê°„</div>
                                    {{#cafe}}{{#operatingHours}}
                                        <pre class="mb-0" style="white-space:pre-wrap">{{.}}</pre>
                                    {{/operatingHours}}{{/cafe}}
                                    {{#cafe}}{{^operatingHours}}<span class="text-muted">ì •ë³´ ì—†ìŒ</span>{{/operatingHours}}{{/cafe}}
                                </li>
                                <li class="mt-2">
                                    <div class="text-muted mb-1">ìê¸°ì†Œê°œ</div>
                                    {{#cafe}}{{#description}}
                                        <pre class="mb-0" style="white-space:pre-wrap">{{.}}</pre>
                                    {{/description}}{{/cafe}}
                                    {{#cafe}}{{^description}}<span class="text-muted">ì†Œê°œê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</span>{{/description}}{{/cafe}}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- ë©”ë‰´(í…ìŠ¤íŠ¸ + ì‚¬ì§„) -->
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-body">
                            <h6 class="mb-3">ë©”ë‰´ ì•ˆë‚´</h6>
                            {{#cafe}}{{#menuText}}
                                <pre class="small mb-3" style="white-space:pre-wrap">{{.}}</pre>
                            {{/menuText}}{{/cafe}}
                            {{#cafe}}{{^menuText}}<div class="small text-muted">ë“±ë¡ëœ ë©”ë‰´ ì†Œê°œê°€ ì—†ìŠµë‹ˆë‹¤.</div>{{/menuText}}{{/cafe}}

                            {{#menuImages}}
                                <div class="row g-2">
                                    {{#.}}
                                        <div class="col-6">
                                            <div class="ratio ratio-16x9 rounded" style="background-image:url('{{.}}')"></div>
                                        </div>
                                    {{/.}}
                                </div>
                            {{/menuImages}}
                        </div>
                    </div>
                </div>

                <!-- íƒœê·¸: ì¹´í…Œê³ ë¦¬ë³„ -->
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h6 class="mb-2">íƒœê·¸</h6>
                            <div class="small text-muted mb-2">ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë“±ë¡ëœ íƒœê·¸ì…ë‹ˆë‹¤.</div>
                            <div class="mb-2">
                                {{#tags.companion}}<span class="chip">ğŸ‘¥ {{.}}</span>{{/tags.companion}}
                            </div>
                            <div class="mb-2">
                                {{#tags.mood}}<span class="chip">ğŸµ {{.}}</span>{{/tags.mood}}
                            </div>
                            <div class="mb-2">
                                {{#tags.amenities}}<span class="chip">ğŸ›ï¸ {{.}}</span>{{/tags.amenities}}
                            </div>
                            <div class="mb-2">
                                {{#tags.reservation}}<span class="chip">ğŸ“… {{.}}</span>{{/tags.reservation}}
                            </div>
                            <div class="mb-0">
                                {{#tags.type}}<span class="chip chip-olive">{{.}}</span>{{/tags.type}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë¦¬ë·° -->
            <div class="card shadow-sm mt-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="m-0">ë¦¬ë·°</h6>
                        <div class="btn-group btn-group-sm">
                            <a class="btn btn-outline-secondary disabled">ìµœì‹ ìˆœ</a>
                            <a class="btn btn-outline-secondary disabled">ë³„ì ìˆœ</a>
                        </div>
                    </div>

                    {{#reviews}}
                        <div class="border rounded p-3 mb-3 bg-white">
                            <div class="d-flex justify-content-between">
                                <div class="fw-semibold">â˜… {{rating}}</div>
                                <div class="small text-muted">{{createdAt}}</div>
                            </div>
                            <div class="small text-muted">ì‘ì„±ì: {{nickname}}</div>
                            <div class="mt-2">{{content}}</div>

                            <div class="mt-2 d-flex gap-2 flex-wrap">
                                {{#imageUrl1}}<img src="{{.}}" class="rounded" style="width:96px;height:96px;object-fit:cover" />{{/imageUrl1}}
                                {{#imageUrl2}}<img src="{{.}}" class="rounded" style="width:96px;height:96px;object-fit:cover" />{{/imageUrl2}}
                                {{#imageUrl3}}<img src="{{.}}" class="rounded" style="width:96px;height:96px;object-fit:cover" />{{/imageUrl3}}
                                {{#imageUrl4}}<img src="{{.}}" class="rounded" style="width:96px;height:96px;object-fit:cover" />{{/imageUrl4}}
                                {{#imageUrl5}}<img src="{{.}}" class="rounded" style="width:96px;height:96px;object-fit:cover" />{{/imageUrl5}}
                            </div>

                            <!-- ì ì£¼ ë‹µê¸€(ê°ì²´í˜•) -->
                            {{#ownerReply}}
                                <div class="owner-reply mt-2">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <div class="fw-semibold">ì ì£¼ ë‹µê¸€</div>
                                        {{#updatedAt}}<div class="meta">{{.}}</div>{{/updatedAt}}
                                    </div>
                                    <div class="small" style="white-space:pre-wrap">{{content}}</div>
                                </div>
                            {{/ownerReply}}

                            <!-- (ëŒ€ì•ˆ) í‰í‰í•œ í•„ë“œë¡œ ë‚´ë ¤ì˜¬ ë•Œ -->
                            {{^ownerReply}}
                                {{#replyContent}}
                                    <div class="owner-reply mt-2">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <div class="fw-semibold">ì ì£¼ ë‹µê¸€</div>
                                            {{#replyUpdatedAt}}<div class="meta">{{.}}</div>{{/replyUpdatedAt}}
                                        </div>
                                        <div class="small" style="white-space:pre-wrap">{{replyContent}}</div>
                                    </div>
                                {{/replyContent}}
                            {{/ownerReply}}
                        </div>
                    {{/reviews}}
                    {{^reviews}}<div class="text-muted">ì•„ì§ ë¦¬ë·°ê°€ ì—†ì–´ìš”.</div>{{/reviews}}
                </div>
            </div>
        </div>

        <!-- ìš°ì¸¡ ì‚¬ì´ë“œ -->
        <div class="col-12 col-lg-4">
            <!-- ì§€ë„/ìœ„ì¹˜ -->
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h6 class="mb-2">ìœ„ì¹˜</h6>
                    {{#hasGeo}}
                        <div class="map-box d-flex align-items-center justify-content-center">
                            <div class="text-muted small">
                                ì§€ë„ ìë¦¬(ì—°ë™ ì˜ˆì •)<br />
                                lat: {{#cafe}}{{lat}}{{/cafe}}, lng: {{#cafe}}{{lng}}{{/cafe}}
                            </div>
                        </div>
                    {{/hasGeo}}
                    {{^hasGeo}}
                        <div class="alert alert-light border small mb-0">ì•„ì§ ì¢Œí‘œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    {{/hasGeo}}
                </div>
            </div>

            <!-- ì—°ë½ì²˜/ë¹ ë¥¸ ì •ë³´ -->
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h6 class="mb-2">ì—°ë½ì²˜</h6>
                    <div class="small">ğŸ“ {{#cafe}}{{#phone}}{{.}}{{/phone}}{{^phone}}-{{/phone}}{{/cafe}}</div>
                    <div class="small">ğŸ“ {{#cafe}}{{addressRoad}}{{/cafe}}</div>
                    {{#cafe}}{{#postcode}}<div class="small">ìš°í¸ë²ˆí˜¸: {{.}}</div>{{/postcode}}{{/cafe}}
                </div>
            </div>

            <!-- ë² ìŠ¤íŠ¸ -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6 class="mb-3">ë² ìŠ¤íŠ¸ (ì¹´í˜ í•«í•œ ê³³)</h6>
                    {{#bestCafes}}
                        <a class="d-flex gap-3 text-decoration-none text-reset border rounded p-2 mb-2"
                           href="/cafes/{{id}}">
                            <div class="ratio ratio-16x9 bg-light"
                                 style="width:120px;background-image:url('{{#heroImageUrl}}{{.}}{{/heroImageUrl}}{{^heroImageUrl}}/images/placeholder_shop.jpg{{/heroImageUrl}}');background-size:cover;background-position:center;border-radius:.5rem"></div>
                            <div class="flex-grow-1">
                                <div class="fw-semibold text-truncate">{{name}}</div>
                                <div class="small text-muted text-truncate">{{addressRoad}}</div>
                                <div class="small mt-1">â­ {{#averageRating}}{{.}}{{/averageRating}}{{^averageRating}}0.0{{/averageRating}} Â· ë¦¬ë·° {{reviewCount}}</div>
                            </div>
                        </a>
                    {{/bestCafes}}
                    {{^bestCafes}}<div class="text-muted small">í‘œì‹œí•  ì¶”ì²œ ë§¤ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>{{/bestCafes}}
                </div>
            </div>
        </div>
    </div>
</main>

{{> layout/footer}}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- (ì„ íƒ) ì¸ë„¤ì¼ í´ë¦­ ì‹œ íˆì–´ë¡œ ì´ë¯¸ì§€ êµì²´ -->
<script>
    document.querySelectorAll('.thumb-rail img').forEach(img=>{
      img.addEventListener('click',()=>{
        const hero = document.querySelector('.hero');
        if(hero) hero.style.backgroundImage = `url('${img.src}')`;
      });
    });
</script>
</body>
</html>
