<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"><title>예약 관리</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/app.css" rel="stylesheet" />
    <style>
        .hidden{display:none!important}
        .res-card .badge-status{min-width:90px}
    </style>
</head>
<body class="bg-body-tertiary">
{{> layout/header}}

<main class="container py-5">
    <h3 class="fw-bold mb-4">점주 페이지</h3>
    <div class="row g-4">
        <!-- 사이드바 -->
        <aside class="col-12 col-md-3">
            <div class="card shadow-sm"><div class="card-body p-0">
                {{> owner/sidebar}}
            </div></div>
        </aside>

        <!-- 본문 -->
        <section class="col-12 col-md-9">
            <div class="card shadow-sm"><div class="card-body p-4">
                <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
                    <h5 class="m-0">예약 관리</h5>

                    <!-- 상태 필터: PENDING / CONFIRMED / CANCELLED -->
                    <div class="d-flex align-items-center gap-2">
                        <label class="form-label m-0 small text-muted">상태</label>
                        <select id="status-filter" class="form-select form-select-sm" style="min-width:180px">
                            <option value="ALL">전체</option>
                            <option value="PENDING">PENDING (대기)</option>
                            <option value="CONFIRMED">CONFIRMED (확정)</option>
                            <option value="CANCELLED">CANCELLED (취소)</option>
                        </select>
                    </div>
                </div>

                <!-- 예약 리스트 -->
                {{#reservations}}
                    <div class="border rounded p-3 mb-2 res-card" data-status="{{status}}">
                        <div class="d-flex justify-content-between gap-3 flex-wrap">
                            <div>
                                <div class="fw-semibold">
                                    {{targetName}}
                                    <span class="badge text-bg-light">{{targetType}}</span>
                                </div>
                                <div class="small text-muted mt-1">
                                    {{reservationAt}} · {{partySize}}명
                                </div>
                            </div>

                            <div class="d-flex align-items-center gap-2">
                                <!-- 상태 배지 -->
                                {{#isPending}}  <span class="badge text-bg-warning badge-status">PENDING</span>{{/isPending}}
                                {{#isConfirmed}}<span class="badge text-bg-success badge-status">CONFIRMED</span>{{/isConfirmed}}
                                {{#isCancelled}}<span class="badge text-bg-secondary badge-status">CANCELLED</span>{{/isCancelled}}

                                <!-- 액션: 대기중 → 승인/취소, 확정 → 취소만, 취소 → 버튼 없음 -->
                                {{#isPending}}
                                    <form method="post" action="/owner/reservations/{{id}}/confirm" class="m-0">
                                        {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                        <button class="btn btn-sm btn-olive" type="submit">승인</button>
                                    </form>
                                    <form method="post" action="/owner/reservations/{{id}}/cancel" class="m-0"
                                          onsubmit="return confirm('이 예약을 취소하시겠습니까?');">
                                        {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                        <button class="btn btn-sm btn-outline-danger" type="submit">취소</button>
                                    </form>
                                {{/isPending}}

                                {{#isConfirmed}}
                                    <form method="post" action="/owner/reservations/{{id}}/cancel" class="m-0"
                                          onsubmit="return confirm('확정된 예약을 취소하시겠습니까?');">
                                        {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                        <button class="btn btn-sm btn-outline-danger" type="submit">취소</button>
                                    </form>
                                {{/isConfirmed}}
                            </div>
                        </div>
                    </div>
                {{/reservations}}

                {{^reservations}}
                    <div class="text-muted">예약 내역이 없습니다.</div>
                {{/reservations}}
            </div></div>
        </section>
    </div>
</main>

{{> layout/footer}}

<script>
    // 상태 필터 (클라이언트 사이드)
    document.addEventListener('DOMContentLoaded', function(){
      const sel = document.getElementById('status-filter');
      const items = [...document.querySelectorAll('.res-card')];
      function apply(){
        const v = sel.value;
        items.forEach(el=>{
          const st = el.dataset.status;
          el.classList.toggle('hidden', v!=='ALL' && st!==v);
        });
      }
      sel.addEventListener('change', apply);
      apply();
    });
</script>
</body>
</html>
