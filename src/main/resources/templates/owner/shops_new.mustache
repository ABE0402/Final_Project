<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"><title>가게 등록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/app.css" rel="stylesheet" />
    <style>
        .tag-card h6{font-weight:600}
        .tag-cloud{display:flex;flex-wrap:wrap;gap:.5rem}
        .tag-chip{border:1px solid #dee2e6;border-radius:999px;padding:.35rem .75rem;font-size:.9rem}
        .tag-chip input{margin-right:.35rem}
        .hidden{display:none!important}
    </style>
</head>
<body class="bg-body-tertiary">
{{> layout/header}}

<main class="container py-5">
    <h3 class="fw-bold mb-4">가게 등록</h3>
    <div class="row g-4">
        <aside class="col-12 col-md-3">
            <div class="card shadow-sm"><div class="card-body p-0">{{> owner/sidebar}}</div></div>
        </aside>

        <section class="col-12 col-md-9">
            <div class="card shadow-sm"><div class="card-body p-4">
                <form method="post" action="/owner/shops/new" enctype="multipart/form-data">
                    {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}

                    <!-- 기본 정보 -->
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">유형</label>
                            <select name="type" id="shop-type" class="form-select" required>
                                <option value="">선택</option>
                                <option value="CAFE">카페</option>
                                <option value="RESTAURANT" disabled>맛집(준비중)</option>
                                ㄴ   </select>
                            <div class="form-text">현재는 카페만 등록 가능합니다.</div>
                        </div>
                        <div class="col-md-8">
                            <label class="form-label">가게 이름</label>
                            <input name="name" class="form-control" required />
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">전화번호</label>
                            <input name="phone" class="form-control" placeholder="예) 02-123-4567" />
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">사업자번호</label>
                            <input name="businessNumber" class="form-control" placeholder="예) 123-45-67890" />
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">우편번호</label>
                            <input name="postcode" class="form-control" placeholder="예) 06236" />
                        </div>

                        <div class="col-md-8">
                            <label class="form-label">도로명 주소</label>
                            <input name="addressRoad" class="form-control" placeholder="예) 서울 강남구 테헤란로 152" required />
                        </div>
                        <div class="col-12">
                            <label class="form-label">상세 주소</label>
                            <input name="addressDetail" class="form-control" placeholder="건물/층/호 등" />
                        </div>

                        <div class="col-12">
                            <label class="form-label">대표 이미지</label>
                            <input type="file" name="image" accept="image/*" class="form-control" />
                        </div>

                        <!-- 자기소개(가게 소개) -->
                        <div class="col-12">
                            <label class="form-label">자기소개(가게 소개)</label>
                            <textarea name="description" rows="4" class="form-control" placeholder="우리 가게를 소개해 주세요."></textarea>
                        </div>

                        <!-- 운영시간 / 메뉴 -->
                        <div class="col-12">
                            <label class="form-label">영업시간 (자유 입력)</label>
                            <textarea name="operatingHours" rows="3" class="form-control" placeholder="예) 평일 09:00~21:00 / 주말 10:00~22:00"></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label">메뉴 안내 (자유 입력)</label>
                            <textarea name="menuText" rows="5" class="form-control" placeholder="예) 아메리카노 4,000 / 라떼 4,500 ..."></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label">메뉴 사진(최대 5장)</label>
                            <input type="file" name="menuImages" class="form-control" accept="image/*" multiple />
                        </div>
                    </div>

                    <hr class="my-4" />

                    <!-- 태그: 카테고리별 최대 제한(data-max) -->
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="card tag-card"><div class="card-body">
                                <h6 class="mb-2">동반인 <small class="text-muted">(최대 2개)</small></h6>
                                <div class="tag-cloud" data-group="companion" data-max="2">
                                    {{#companionTags}}
                                        <label class="tag-chip">
                                            <input type="checkbox" class="tag-chk" name="tagIds" value="{{id}}" data-group="companion" {{#selected}}checked{{/selected}} />
                                            {{name}}
                                        </label>
                                    {{/companionTags}}
                                </div>
                            </div></div>
                        </div>

                        <div class="col-12">
                            <div class="card tag-card"><div class="card-body">
                                <h6 class="mb-2">분위기 <small class="text-muted">(최대 2개)</small></h6>
                                <div class="tag-cloud" data-group="mood" data-max="2">
                                    {{#moodTags}}
                                        <label class="tag-chip">
                                            <input type="checkbox" class="tag-chk" name="tagIds" value="{{id}}" data-group="mood" {{#selected}}checked{{/selected}} />
                                            {{name}}
                                        </label>
                                    {{/moodTags}}
                                </div>
                            </div></div>
                        </div>

                        <div class="col-12">
                            <div class="card tag-card"><div class="card-body">
                                <h6 class="mb-2">편의 및 서비스 <small class="text-muted">(최대 2개)</small></h6>
                                <div class="tag-cloud" data-group="amenities" data-max="2">
                                    {{#amenityTags}}
                                        <label class="tag-chip">
                                            <input type="checkbox" class="tag-chk" name="tagIds" value="{{id}}" data-group="amenities" {{#selected}}checked{{/selected}} />
                                            {{name}}
                                        </label>
                                    {{/amenityTags}}
                                </div>
                            </div></div>
                        </div>

                        <div class="col-12">
                            <div class="card tag-card"><div class="card-body">
                                <h6 class="mb-2">예약여부 <small class="text-muted">(최대 1개)</small></h6>
                                <div class="tag-cloud" data-group="reservation" data-max="1">
                                    {{#reservationTags}}
                                        <label class="tag-chip">
                                            <input type="checkbox" class="tag-chk" name="tagIds" value="{{id}}" data-group="reservation" {{#selected}}checked{{/selected}} />
                                            {{name}}
                                        </label>
                                    {{/reservationTags}}
                                </div>
                            </div></div>
                        </div>

                        <div class="col-12">
                            <div class="card tag-card"><div class="card-body">
                                <h6 class="mb-2">우선순위 <small class="text-muted">(최대 2개)</small></h6>
                                <div class="tag-cloud" data-group="priority" data-max="2">
                                    {{#priorityTags}}
                                        <label class="tag-chip">
                                            <input type="checkbox" class="tag-chk" name="tagIds" value="{{id}}" data-group="priority" {{#selected}}checked{{/selected}} />
                                            {{name}}
                                        </label>
                                    {{/priorityTags}}
                                </div>
                            </div></div>
                        </div>

                        <div class="col-12">
                            <div class="card tag-card"><div class="card-body">
                                <h6 class="mb-2">종류 <small class="text-muted">(최대 2개, 유형 연동)</small></h6>
                                <div class="tag-cloud" id="type-cloud" data-group="type" data-max="2">
                                    {{#typeTags}}
                                        <label class="tag-chip type-chip" data-name="{{name}}">
                                            <input type="checkbox" class="tag-chk type-chk" name="tagIds" value="{{id}}" data-group="type" {{#selected}}checked{{/selected}} />
                                            {{name}}
                                        </label>
                                    {{/typeTags}}
                                </div>
                                <div class="form-text">
                                    카페: 디저트 전문 / 커피 전문 / 인테리어 맛집<br/>
                                    맛집: 한식 / 중식 / 일식 / 양식 / 퓨전 / 아시안
                                </div>
                            </div></div>
                        </div>
                    </div>

                    <div class="mt-4 d-flex">
                        <a class="btn btn-outline-secondary" href="/owner/shops">목록</a>
                        <button class="btn btn-olive ms-auto" type="submit">등록(승인대기)</button>
                    </div>
                </form>
            </div></div>
        </section>
    </div>
</main>

{{> layout/footer}}

<script>
    // 태그 카테고리별 선택 개수 제한
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.tag-chk').forEach(cb => {
        cb.addEventListener('change', e => {
          const group = e.target.dataset.group;
          const wrap = e.target.closest('.tag-cloud');
          const max = parseInt(wrap?.dataset.max || '2', 10);
          const checked = [...document.querySelectorAll(`.tag-chk[data-group="${group}"]:checked`)];
          if (checked.length > max) {
            e.target.checked = false;
            alert(`${group} 태그는 최대 ${max}개까지 선택 가능합니다.`);
          }
        });
      });

      // 유형에 따라 '종류' 태그 보이기/숨기기
      const typeSelect = document.getElementById('shop-type');
      const chips = [...document.querySelectorAll('.type-chip')];
      const cafeType = new Set(['디저트 전문','커피 전문','인테리어 맛집']);
      const restType = new Set(['한식','중식','일식','양식','퓨전','아시안']);

      function applyFilter(){
        const val = typeSelect.value;
        chips.forEach(ch => {
          const name = ch.dataset.name;
          let show = true;
          if (val === 'CAFE') show = cafeType.has(name);
          else if (val === 'RESTAURANT') show = restType.has(name);
          ch.classList.toggle('hidden', !show);
          if (!show) ch.querySelector('input').checked = false;
        });
      }
      typeSelect.addEventListener('change', applyFilter);
      applyFilter();
    });
</script>
</body>
</html>
